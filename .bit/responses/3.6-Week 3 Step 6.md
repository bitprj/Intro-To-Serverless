---
files: n/a
stepType: checks
scripts: test.3.6.js
week: 3
step: 6
name: Can you keep a secret?
---

Week 3 Step 6 ‚¨§‚¨§‚¨§‚¨§‚¨§‚¨§‚óØ‚óØ‚óØ | üïê Estimated completion: 10-20 minutes

## Can you keep a secret?
*This week, you will be going through steps to set up a Twilio account and create an Azure function that texts your Twilio number.*

### ‚úÖ  Task:

- [ ]  Make sure you're on the `week3` branch
- [ ]  Set up a Twilio Account
- [ ]  Create an Azure Function
- [ ]  Fill in the Azure Function URL as a webhook
- [ ]  Test your function by texting your Twilio number and seeing output in the console
- [ ]  Return the Twilio SMS message's content from the function

### Set Up a Twilio Account

Sign up for a free Twilio trial account [here](https://www.twilio.com/try-twilio). 

<details>
<summary>:question: What's the process like for signing up for Twilio?</summary>

- When you sign up, you'll be asked to verify your personal phone number. This helps Twilio verify your identity and also allows you to send test messages to your phone from your Twilio account while in trial mode.

- Once you verify your number, you'll be asked a series of questions to customize your experience.

- Once you finish the onboarding flow, you'll arrive at your project dashboard in the Twilio Console. This is where you'll be able to access your Account SID, authentication token, find a Twilio phone number, and more.

</details>

After we get our account set up, we need to set up the app keys for the Twilio API.

<details>
<summary>:question: How can we set up app keys for the Twilio API?</summary>

1. [Create a new project](https://support.twilio.com/hc/en-us/articles/360011177133-View-and-Create-New-Projects-in-Twilio-Console) on Twilio.

2. [Add a brand new number](https://support.twilio.com/hc/en-us/articles/360019485393-Add-and-Configure-a-New-Phone-Number-with-Twilio-Flex) for your Twilio project, which will be used to send texts to users. Save this to use for later.

3. Go to the dashboard of your Twilio project, and in the **Project Info** section, you should see **Account SID** and **Auth Token**. We will save these as app keys in our Azure Function App.
   ![](https://github.com/thearchitectsnotebook/flux/blob/master/public/images/twilio-keys.PNG?raw=true)

4. Navigate to your Azure Function App page, and go to **App keys** underneath **Functions** on the left bar. Add two **New host keys**. 
   - Name: `TwilioAccountSid`, Value: `YOUR_ACCOUNT_SID` 
   - Name: `TwilioAuthToken`, Value: `YOUR_AUTH_TOKEN`

5. Your app host keys should now look like:  
   ![host keys](https://github.com/thearchitectsnotebook/flux/blob/master/public/images/host-keys.PNG?raw=true)

</details>

Finally, we need to install the `npm` package `querystring` to use in our function code later.

<details>
<summary>:question: How do I install `npm` packages?</summary>
</br>

Click on the "Console" tab in the left panel under "Development Tools".

![https://user-images.githubusercontent.com/69332964/99189070-59e31d00-272d-11eb-80a4-17444e5fac65.png](https://user-images.githubusercontent.com/69332964/99189070-59e31d00-272d-11eb-80a4-17444e5fac65.png)

Inside the console (shown on the right panel), type in the following command:

[`npm install querystring`](https://www.npmjs.com/package/querystring) <br />

</details>

### Create an Azure Function

Next, we'll want to create an Azure Function that will eventually output the content of texts that your Twilio number receives. This will just be a simple HTTP trigger function.

<details>
<summary>:question: Can I have an example?</summary>

![image](https://user-images.githubusercontent.com/49426183/120203771-eabaab00-c1dc-11eb-8d4d-5ddf31b818b7.png)

</details>

### Configure Your Webhook URL

When someone sends a text message to your Twilio number, Twillio can call a webhook you create in Node.js from which you can send a reply back using TwiML.

<details>
<summary>:question: Webhook? TwiML? I'm lost!</summary>
</br>

Fear not! 

[Webhooks](https://www.twilio.com/docs/usage/webhooks) are essentially just HTTP callbacks that are triggered by an event - in our case, this event is receiving an SMS message. When that event occurs, Twilio makes an HTTP request to the URL configured for the webhook.

[TwiML](https://www.twilio.com/docs/voice/twiml) is the Twilio Markup Language, which is just to say that it's an XML document with special tags defined by Twilio to help you build your SMS and voice applications. 

</details>

We'll configure the Webhook URL by filling in the Azure Function URL as a webhook.

<details>
<summary>:question: How do I find my Azure Function URL?</summary>
</br>

Navigate to your Function page (Overview), and click `Get Function URL`.

![image](https://user-images.githubusercontent.com/49426183/120208560-784cc980-c1e2-11eb-8ad2-fd18597932ea.png)

</details>

<details>
<summary>:question: How do I configure my Twilio webhook URL?</summary>
</br>

1. Go to the [Twilio Console's Numbers page](https://www.twilio.com/console/phone-numbers/incoming)

![image](https://user-images.githubusercontent.com/49426183/120208171-06748000-c1e2-11eb-91a7-06c427967d46.png)

2. Click on the phone number you'd like to modify

3. Scroll down to the Messaging section and the "A MESSAGE COMES IN" option.

4. Paste in your Azure Function URL. Make sure to click `Save` afterwards!!

![image](https://user-images.githubusercontent.com/49426183/120208692-a0d4c380-c1e2-11eb-85fa-ed8463d1da43.png)

</details>


### Write your Azure Function

Now, we'll want to write our Azure Function. Go to the code for the function you created previously in this step.

First, we'll need to instantiate our `querystring` npm package in order to use it.

<details>
<summary>:question: How do I use the `querystring` package?</summary>

```js
const querystring = require('querystring');
```

</details>

Next, we'll use the `querystring` object to parse our request's body. 

<details>
<summary>:question: How do I parse the request body?</summary>

```js
const queryObject = querystring.parse(req.body);
```

</details>

From this output, we'll find its `Body` attribute and return it.

<details>
<summary>:question: How do I return the output?</summary>

```js
context.res = {
   body: queryObject.Body
};
```

</details>

### Test Your Work

To test your work, try texting a message to your Twilio number - you should receive a text message back that repeats your own message.

<details>
<summary>:question: How do I find my Twilio number?</summary>

See your [phone numbers](https://www.twilio.com/console/phone-numbers/incoming).

</details>

![194569969_1687986154736022_4227041675617722938_n](https://user-images.githubusercontent.com/49426183/120210870-1e99ce80-c1e5-11eb-9619-3a812f6206a7.jpg)

> üí° Yay! This means you've successfully configured your Twilio webhook.