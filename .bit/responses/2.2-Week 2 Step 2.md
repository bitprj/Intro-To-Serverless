---
files: n/a
stepType: IssueComment
scripts: n/a
week: 2
step: 2
name: Week 2 Step 2
---
Week 2 Step 2 ‚¨§‚¨§‚óØ‚óØ‚óØ‚óØ | üïê Estimated completion: 5-20 minutes
## Your API is a poet and it knows it
Now that we can successfully return face emotion data from an image, let's write some code to return a poem from our Azure function about *the most dominant emotion.*

### ‚úÖ Task:
**Add on to your Azure function so that it determines the face's prominent emotion and returns a matching poem.**

- [ ]  Run `git pull` 
- [ ]  Make sure you are in the `week2` branch 
- [ ]  Modify your serverless function from the previous step to determine the dominant emotion
- [ ]  Return a matching poem as the result (ex: a happy face would get a "happy" poem.)
- [ ] Commit your code to `week2/emotional.js`

### The Poems
Use this JSON array as poems to return for each emotion.

<details>
<summary>:newspaper: Poems </summary>

```json
{
    "anger": "I was angry with my friend;\nI told my wrath, my wrath did end.\nI was angry with my foe:\nI told it not, my wrath did grow.\nAnd I waterd it in fears,\nNight & morning with my tears:\nAnd I sunned it with smiles,\nAnd with soft deceitful wiles.\nAnd it grew both day and night.\nTill it bore an apple bright.\nAnd my foe beheld it shine,\nAnd he knew that it was mine.\nAnd into my garden stole,\nWhen the night had veild the pole;\nIn the morning glad I see;\nMy foe outstretched beneath the tree. (William Blake)",
    "contempt": "How far does contempt lead a man to? How far?\nI will descent, stark naked.\nThe earth below my feet will resonate in shudder,\nwith my hurt ego, in disbalanced steps\nI shall go down the same way as\nthe unknown zodiacal stars glide down the sky.\nAnd then, your world will burst out in laughter,\npelt stones at me, chant sarcastic words.\nI shall surely go down the track\nthe way tears will down your eyes in mute sadness.\nHow far does contempt lead a man to.\nDo you know? Do you,\nwhom you have animated into a tearful existence. (Sukumar Choudhuri)",
    "disgust": "Disgust equates to repulsion.\nYet, does repulsion translate to disgust?\nBean boozled jelly beans and candy that explodes with the taste of dog food.\nRotten fish with the aftertaste of dishwasher soap. Bean boozled jelly beans.\nNever, ever, ever, again. (Emily)" ,
    "fear": "A darting fear‚Äîa pomp‚Äîa tear‚Äî\nA waking on a morn\nTo find that what one waked for,\nInhales the different dawn. (Emily Dickinson)",
    "happiness": "How happy is the little Stone\nThat rambles in the Road alone,\nAnd doesn't care about Careers\nAnd Exigencies never fears‚Äî\nWhose Coat of elemental Brown\nA passing Universe put on,\nAnd independent as the Sun\nAssociates or glows alone,\nFulfilling absolute Decree\nIn casual simplicity‚Äî (Emily Dickinson)",
    "neutral": "I wear neutral\nThe color of the sand\nThe color of the stone\nThe color of the stream\nThe color of the sun\nBut not for these reasons do I wear\nthe color congenial.\nFor in neutral, I'm as congenital\nas monkeys on a tree.\nIt comes in different shades,\nthis color neutral.\nSome call it brown\nSome, taupe or beige\nSome say pearl!\nWhich prompts laughter.\nOthers, universal, echo earthy\nI say simply\n'neutral.'\nSome say it complements me\nOthers find it boring\nWhy don't you wear bright colors?\nThey ask.\nWhy throw red paint on a bustard?\nThe vultures would see through the peels\nand the other bustards would take to their heels. (Birgitta Abimbola Heikka)",
    "sadness": "Laugh, and the world laughs with you;\nWeep, and you weep alone;\nFor the sad old earth must borrow its mirth,\nBut has trouble enough of its own.\nSing, and the hills will answer;\nSigh, it is lost on the air;\nThe echoes bound to a joyful sound,\nBut shrink from voicing care.\nRejoice, and men will seek you;\nGrieve, and they turn and go;\nThey want full measure of all your pleasure,\nBut they do not need your woe.\nBe glad, and your friends are many;\nBe sad, and you lose them all,\nThere are none to decline your nectared wine,\nBut alone you must drink life's gall.\nFeast, and your halls are crowded;\nFast, and the world goes by.\nSucceed and give, and it helps you live,\nBut no man can help you die.\nThere is room in the halls of pleasure\nFor a large and lordly train,\nBut one by one we must all file on\nThrough the narrow aisles of pain.\n(Ella Wheeler Wilcox)",
    "surprise": "It did not surprise me‚Äî\nSo I said‚Äîor thought‚Äî\nShe will stir her pinions\nAnd the nest forgot,\n\nTraverse broader forests‚Äî\nBuild in gayer boughs,\nBreathe in Ear more modern\nGod's old fashioned vows‚Äî\n\nThis was but a Birdling‚Äî\nWhat and if it be\nOne within my bosom\nHad departed me?\n\nThis was but a story‚Äî\nWhat and if indeed\nThere were just such coffin\nIn the heart instead? (Emily Dickinson)"
}
```

</details>
<br>

### üöß Test your Work
Use **Postman**! Paste the *function url* and make a POST request. Remember to attach the file in `Body`! In the output box, you should get the output. Make sure you're using an image with a *real face* on it or else it won't work. Here's an example of an output I get with [this image](https://user-images.githubusercontent.com/69332964/98884689-91687580-245e-11eb-98d7-6461ac79e02a.jpg):

<details>
<summary>:white_check_mark: Expected Output </summary>
<br>

```json
{
  "final_poem": "How happy is the little Stone\nThat rambles in the Road alone,\nAnd doesn't care about Careers\nAnd Exigencies never fears‚Äî\nWhose Coat of elemental Brown\nA passing Universe put on,\nAnd independent as the Sun\nAssociates or glows alone,\nFulfilling absolute Decree\nIn casual simplicity‚Äî (Emily Dickinson)"
}
```
</details>

<details>
<summary>:question: Confused about Postman? </summary>

* Navigate back to the Postman app and change GET to POST
![Untitled_ Nov 11, 2020 6_24 PM](https://user-images.githubusercontent.com/69332964/98876201-c3bca780-244b-11eb-9b94-8d3cecc80115.gif)

* Copy your function's url from the Azure Function App portal like this:
![httptrigger - Microsoft Azure](https://user-images.githubusercontent.com/69332964/98876502-6f65f780-244c-11eb-832b-a25888b980da.gif)

* Use the function url and any image you want to send the POST request. Remember to attach the file in Body!
![Untitled_ Nov 11, 2020 6_40 PM](https://user-images.githubusercontent.com/69332964/98876997-780afd80-244d-11eb-87fc-13822d909f2f.gif)
</details>

## Determining the dominant emotion
Previously, we received a **JSON object of emotion data** as the result from our API. Now, to take it a step further, we need to identify which emotion **has the highest value**.

<details>
<summary>How can I find the dominant emotion?</summary>
</br>

Take a look at the JSON object with emotion data:
> :bulb: Tip: You can see this if you use `context.log(result)`
```json
      {
        "faceId": "d25465d6-0c38-4417-8466-cabdd908e756",
        "faceRectangle": {
          "top": 313,
          "left": 210,
          "width": 594,
          "height": 594
        },
        "faceAttributes": {
          "emotion": {
            "anger": 0,
            "contempt": 0,
            "disgust": 0,
            "fear": 0,
            "happiness": 1,
            "neutral": 0,
            "sadness": 0,
            "surprise": 0
          }
        }
      }
    ]
```

First, let's define the emotions we're going to be analyzing. In this case, `result` is the JSON object/array.
```js
let emotions = result[0].faceAttributes.emotion
```

This narrows down the array to:
```json
{
    "anger": 0,
    "contempt": 0,
    "disgust": 0,
    "fear": 0,
    "happiness": 1,
    "neutral": 0,
    "sadness": 0,
    "surprise": 0
}
```

Now, to find the max value, we an isolate the key values (ex: 0, 0, 1) into another array.
```js
let objects = Object.values(emotions)
```

If you `console.log` the `objects` array, you would get something like: `[0, 0, 0, 0, 1, 0, 0, 0]`. Now, [**write a line of code that identifies the greatest value in this array**](https://medium.com/@vladbezden/how-to-get-min-or-max-of-an-array-in-javascript-1c264ec6e1aa). Name the value `maxemotion`!

Finally, let's search for the max value (which is 1) in the `emotions` JSON object.
```js
const key = Object.keys(emotions).find(key => emotions[key] === maxemotion)
// Object.keys lists out "fear, happiness, neutral, etc." and the .find() method matches the value 1 (maxemotion) with a key.
```

The variable `key` should now contain the dominant emotion.
</details>

### Returning a Poem
Now that we have the dominant emotion in the picture, use it to **provide the corresponding poem** and return it in the request body.

<details>
<summary>:question: How can I get the correct poem? </summary>
<br>

Take the variable that contains the dominant emotion. Ours is called `key`. Then, using the provided JSON object of poems, define an object called `poems`.

```js
let poems = {
    // use the poems we gave you!
}
```

To access the poem that matches the emotion, fill in the gaps in this line of code.

```js
let final_poem = CHANGE_THIS[WHAT_IS_THIS]
// CHANGE_THIS --> what is the JSON object?
// WHAT_IS_THIS --> what is the type of poem you want to access?

// these are both VARIABLES!
```
</details>

<details>
<summary>:exclamation: How should I return the poem? </summary>
<br>

Same as always, use the `context.res` object to return something from the Azure function.
```js
    context.res = {
            body: {
                //WHAT'S THE VARIABLE YOU WANT TO RETURN?
            }
    };
```
</details>
