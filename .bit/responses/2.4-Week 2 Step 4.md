---
files: n/a
stepType: checks
scripts: test.2.4.js
week: 2
step: 4
name: Week 2 Step 4
---

Week 2 Step 4 ‚¨§‚¨§‚¨§‚¨§‚óØ‚óØ‚óØ‚óØ | üïê Estimated completion: 5-10 minutes

## Getting Emotional ~ Returning the Dominant Emotion

### ‚úÖ Task:
**Modify your Azure Function so that it returns the Dominant Emotion of an Image.**
- [ ] 1. In your function `emotionalgifs`, determine the dominant emotion in the emotion data and output the dominant emotion in the request body when you make a `POST` request
- [ ] üöÄ Commit your code to `emotionalgifs/index.js` on the `emotionalgifs` branch

## 1. Finding the Dominant Emotion
In order to match the results of the Face API with Gifs from the **Giphy API**, we need to determine the dominant emotion from the API response.

### :hammer_and_wrench: Modifying the Azure Function
We need to access the emotion data **by itself**, without the face id and other analyzed data. To do this, we need to create **another variable** in the `module.exports` async function.

```js
let emotions = result[0].faceAttributes.emotion;
```
:bulb: Now you've got the JSON object with all the emotion values, find the highest valued emotion! **Use `context.log(emotions)` to see how it's structured.**
> We're accessing the data at index 0 because we're analyzing **one face**. If there were two faces, the data for the second face would be stored at index 1.

<details>
<summary>‚ùì How do I find the max value from the JSON object?</summary>
 </br>

Recall that the entire JSON response object looks like this: 
```js
{
  "result": [
    {
      "faceId": "a16f522d-0577-4e50-97cb-1feeef7aaf2e",
      "faceRectangle": {
        "top": 313,
        "left": 210,
        "width": 594,
        "height": 594
      },
      "faceAttributes": {
        "emotion": {
          "anger": 0,
          "contempt": 0,
          "disgust": 0,
          "fear": 0,
          "happiness": 1,
          "neutral": 0,
          "sadness": 0,
          "surprise": 0
        }
      }
    }
  ]
}

```
üí° The code that we want is the `emotion` part of the response, not the entire thing. 
- Therefore, we will use the previously created variable `emotions`, which stores:

```js
"emotion": {
          "anger": 0,
          "contempt": 0,
          "disgust": 0,
          "fear": 0,
          "happiness": 1,
          "neutral": 0,
          "sadness": 0,
          "surprise": 0
        }
```

> :bulb: In JSON, the **key** values are what you use to access the **value**. `{key: value}`, or in our case, `{emotion: value}`. If we wanted to access `happiness` from the `emotions` JSON, we can use `emotions["happiness"]`, which returns `1`.

In order to find the dominant emotion, we will need to find which key (anger, contempt, disgust, etc) has the highest respective value. In this example, we see that `happiness` has the highest value. Here are the steps to do this in code:

‚ùó **Overview:** We will first set `maxValue` to 0. We will also declare a variable named `var main_emotion = "none"`. This is because we have not yet started looking at the the keys and values in the JSON yet.  Then, we will need to look at each key in the emotions JSON, and check if its respective value is higher than the max value. If `maxValue` is lower this key's value, then we look at the next key. However, if this key is larger than `maxValue` we will set `maxValue` equal to that key's value, and set `main_emotion` equal to that key (which is the emotion). Then, we look at the next key, and the process repeats. Finally, after looking at every key, we will return `main_emotion`, because it will contain the emotion with the highest value, which is the dominant meotion. 

That giant paragraph written in JavaScript:
```js
function determine_main_emotion(emotionJSON) {
    let maxValue = 0; 
    let main_emotion = "none";

    for (var emo in emotionJSON) { 
        if (emotionJSON[emo] > maxValue) {
            maxValue = emotionJSON[emo];
            main_emotion = emo;
        }
    }
    return main_emotion
}
```
:bulb: We create this function `determine_main_emotion` outside of the `module.exports`. 

**Function Breakdown**
1. we first declare `maxValue` to 0 and set `main_emotion` to "none", like our overview said.
2. the fourth line is a *for-loop* in JavaScript. We are using this loop to look at EACH key in `emotionJSON` (which is the emotions json passed in). Each time this loop runs, `emo` will be set to anger, contempt, disgust, etc. 
3.  we then check if the value for the key in `emotionJSON` is greater than the current max value. If it is, then we set `maxValue` to be the new value in `emotionJSON[emo]`, which in the case of the key `happiness`, will be `maxValue = 1`, because `emotionJSON[emo]` evaluates to 1. We then set `main_emotion` equal to the `emo` key, which is (anger, contempt, disgust, etc). 
4. however, if the value for that key is NOT greater than `maxValue`, we do nothing and look at the next key.
5. this way, the return statement, which runs after the entire loop is done, will return the emotion with the highest value.

- To access this function, we call `let main_emo_return = determine_main_emotion(emotions)`, passing in the `emotions` JSON object created earlier. 

3Ô∏è‚É£ Now, `main_emo_return` contains the dominant emotion! All we need to do is output `main_emo_return` when the function is called:

```js
context.res = {
        // status: 200, /* Defaults to 200 */
        body: main_emo_return
};
```
<br>
</details>

